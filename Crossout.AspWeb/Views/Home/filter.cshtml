@using Crossout.Web
@using Crossout.AspWeb.Models.Filter
@model Crossout.AspWeb.Models.General.SearchModel
@{ 
    var loc = Model.Localizations;
}

<div id="filterWrapper" class="d-none">
    <div class="d-flex justify-content-center">
        <div id="legacyFilters" class="d-none card my-1 px-1 mx-3 flex-row"></div>
    </div>

    <div class="half-hd-container px-3">
        <div class="card my-1 px-1">
            <div class="d-flex justify-content-center row" id="dropdownFilter">
                <div class="btn-group btn-group-sm align-self-start col my-1" role="group">
                    <button id="factionsDropdown" type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <loc model="loc" category="shared" name="tablehead.faction">Faction</loc>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="factionsDropdown">
                        @foreach (FilterItem item in Model.FilterModel.Factions)
                        {
                            <a class="dropdown-item item-filter filter-faction">@item.Name</a>
                        }
                    </div>
                </div>
                <div class="btn-group btn-group-sm align-self-start col my-1" role="group">
                    <button id="categoryDropdown" type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <loc model="loc" category="shared" name="tablehead.category">Category</loc>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="categoryDropdown">
                        @foreach (FilterItem item in Model.FilterModel.Categories)
                        {
                            <a class="dropdown-item item-filter filter-category">@item.Name</a>
                        }
                    </div>
                </div>
                <div class="btn-group btn-group-sm align-self-start col my-1" role="group">
                    <button id="rarityDropdown" type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <loc model="loc" category="shared" name="tablehead.rarity">Rarity</loc>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="rarityDropdown">
                        @foreach (RarityItem item in Model.FilterModel.Rarities)
                        {
                            <a class="dropdown-item item-filter filter-rarity">@item.Name</a>
                        }
                    </div>
                </div>
                <div class="btn-group btn-group-sm align-self-start col my-1" role="group">
                    <button id="otherDropdown" type="button" class="btn btn-outline-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <loc model="loc" category="shared" name="filter.other">Other</loc>
                    </button>
                    <div class="dropdown-menu" aria-labelledby="otherDropdown">
                        <a class="dropdown-item item-filter filterCraftableItems"><loc model="loc" category="shared" name="tablehead.craftable">Craftable</loc></a>
                        <a class="dropdown-item item-filter filterRemovedItems @(Model.FilterModel.CurrentShowRemovedItemsOnly ? "active" : "")"><loc model="loc" category="shared" name="filter.removed">Removed</loc></a>
                        <a class="dropdown-item item-filter filterMetaItems"><loc model="loc" category="shared" name="tablehead.meta">Meta</loc></a>
                    </div>
                </div>
            </div>

            <div class="d-none justify-content-center row" id="expandedFilter">
                <div class="btn-group-vertical btn-group-sm align-self-start col m-1" role="group" aria-label="Faction Filter">
                    @foreach (FilterItem item in Model.FilterModel.Factions)
                    {
                        <button class="btn btn-outline-secondary item-filter filter-faction" type="button">@item.Name</button>
                    }
                </div>
                <div class="btn-group-vertical btn-group-sm align-self-start col m-1" role="group" aria-label="Category Filter">
                    @foreach (FilterItem item in Model.FilterModel.Categories)
                    {
                        <button class="btn btn-outline-secondary item-filter filter-category" type="button">@item.Name</button>
                    }
                </div>
                <div class="btn-group-vertical btn-group-sm align-self-start col m-1" role="group" aria-label="Rarity Filter">
                    @foreach (RarityItem item in Model.FilterModel.Rarities)
                    {
                        <button class="btn btn-outline-secondary item-filter filter-rarity" type="button">@item.Name</button>
                    }
                </div>
                <div class="btn-group-vertical btn-group-sm align-self-start col m-1" role="group" aria-label="Special filter">
                    <button class="btn btn-outline-secondary item-filter filterCraftableItems"><loc model="loc" category="shared" name="tablehead.craftable">Craftable</loc></button>
                    <button class="btn btn-outline-secondary item-filter filterRemovedItems"><loc model="loc" category="shared" name="filter.removed">Removed</loc></button>
                    <button class="btn btn-outline-secondary item-filter filterMetaItems"><loc model="loc" category="shared" name="tablehead.meta">Meta</loc></button>
                </div>
            </div>

            <div id="rangeFilter" class="row">
                <div id="defaultRange" class="col-md-6 col-sm-12 pr-md-0">
                    <div class="flex-column flex-fill mr-md-1">
                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.sellprice">Sell Price</loc></span>
                            </div>
                            <input type="text" class="form-control" id="sellmin" name="sellmin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="sellmax" name="sellmax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.buyprice">Buy Price</loc></span>
                            </div>
                            <input type="text" class="form-control" id="buymin" name="buymin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="buymax" name="buymax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1 d-none d-md-flex invisible">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text">Placeholder</span>
                            </div>
                            <input type="text" class="form-control" id="placeholdermin" name="placeholdermin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="placeholdermax" name="placeholdermax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>
                    </div>
                </div>
                <div id="placeHolderRange" class="col-md-6 col-sm-12 pl-md-0">
                    <div class="card mx-sm-0 ml-md-1 my-1 p-1 flex-fill justify-content-center">
                        <div class="text-secondary text-center"><loc model="loc" category="search" name="filter.desc.rangefilter">Choose a different view to enable other range filters</loc></div>
                    </div>
                </div>
                <div class="d-none col-md-6 col-sm-12 pl-md-0" id="craftingRange">
                    <div class="flex-column flex-fill ml-md-1">
                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.craftcostsell"></loc>Craft Cost (Sell)</span>
                            </div>
                            <input type="text" class="form-control" id="craftcostsellmin" name="craftcostsellmin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="craftcostsellmax" name="craftcostsellmax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.craftcostbuy">Craft Cost (Buy)</loc></span>
                            </div>
                            <input type="text" class="form-control" id="craftcostbuymin" name="craftcostbuymin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="craftcostbuymax" name="craftcostbuymax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.craftingmargin">Crafting Margin</loc></span>
                            </div>
                            <input type="text" class="form-control" id="carftingmarginmin" name="carftingmarginmin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="carftingmarginmax" name="carftingmarginmax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>
                    </div>
                </div>
                <div class="d-none col-md-6 col-sm-12 pl-md-0" id="flippingRange">
                    <div class="flex-column flex-fill ml-md-1">
                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.margin">Margin</loc></span>
                            </div>
                            <input type="text" class="form-control" id="marginmin" name="marginmin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="marginmax" name="marginmax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.roi">ROI</loc></span>
                            </div>
                            <input type="text" class="form-control" id="roimin" name="roimin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="roimax" name="roimax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>

                        <div class="input-group input-group-sm my-1">
                            <div class="input-group-prepend">
                                <span class="input-group-text filter-range-text"><loc model="loc" category="shared" name="tablehead.demandsupply">Demand/Supply</loc></span>
                            </div>
                            <input type="text" class="form-control" id="demandsupplymin" name="demandsupplymin" onkeyup="drawTable()" aria-label="From Amount" placeholder="From">
                            <input type="text" class="form-control" id="demandsupplymax" name="demandsupplymax" onkeyup="drawTable()" aria-label="To Amount" placeholder="To">
                        </div>
                    </div>
                </div>
            </div>

            <div class="d-flex flex-fill row">
                <div class="btn-group my-1 col-md-6 col-sm-12 pr-md-1">
                    <button class="btn btn-sm btn-outline-secondary disabled" id="watchlistSelector" onclick="watchlistSelected()"><loc model="loc" category="search" name="filter.watchlistselect">Watchlist Selected</loc></button>
                    <button class="btn btn-sm btn-outline-secondary" id="watchlistFilter" onclick="toggleWatchlist()"><loc model="loc" category="search" name="filter.showwatchlist">Show Watchlist</loc></button>
                </div>
                <div class="btn-group my-1 col-md-6 col-sm-12 pl-md-1">
                    <button class="btn btn-sm btn-outline-secondary filter-preset active" id="defaultPreset" onclick="switchPreset('default', true)"><loc model="loc" category="search" name="filter.preset.default">Default</loc></button>
                    <button class="btn btn-sm btn-outline-secondary filter-preset" id="craftingPreset" onclick="switchPreset('crafting', true)"><loc model="loc" category="search" name="filter.preset.crafting">Crafting</loc></button>
                    <button class="btn btn-sm btn-outline-secondary filter-preset" id="flippingPreset" onclick="switchPreset('flipping', true)"><loc model="loc" category="search" name="filter.preset.flipping">Flipping</loc></button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        checkFilterSetting();
        checkExtendedSetting();
    });

    function checkFilterSetting() {
        var filterStyle = readFilterSettings();

        switch (filterStyle) {
            case 'vertical-buttons':
                $('#dropdownFilter').removeClass('d-flex');
                $('#dropdownFilter').addClass('d-none');

                $('#expandedFilter').removeClass('d-none');
                $('#expandedFilter').addClass('d-flex');
                break;
            case 'legacy-filters':
                $('#dropdownFilter').removeClass('d-flex');
                $('#dropdownFilter').addClass('d-none');

                $('#expandedFilter .btn-group-vertical').removeClass('btn-group-vertical col').addClass('btn-group');
                $('#expandedFilter').children('.btn-group').appendTo('#legacyFilters');

                $('#expandedFilter').removeClass('d-none');
                $('#expandedFilter').addClass('d-flex');
                $('#legacyFilters').removeClass('d-none').addClass('d-inline-flex');
                break;
            default:
                break;
        }
    }

    function checkExtendedSetting() {
        var rangeFilterSetting = readSetting('range-filters');
        if (!rangeFilterSetting) {
            $('#rangeFilter').removeClass('d-md-flex d-sm-block');
            $('#rangeFilter').addClass('d-none');
        }

        var exportButtonSettings = readSetting('export-buttons');
        if (!exportButtonSettings) {
            $('#exportButtons').addClass('d-none');
        }
    }

    // Keep dropdown open after selection
    $('.dropdown-menu').click(function (e) {
        e.stopPropagation();
    });
</script>
